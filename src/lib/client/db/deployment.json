[
  {
    "idx": 0,
    "when": 1749896014745,
    "tag": "0000_cold_imperial_guard",
    "hash": "7550fd42a57272be5cdff18eed74da1c62852bc5e12eb3e590ea297c63635830",
    "sql": [
      "CREATE TABLE \"chats\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"title\" text,\"title_manually_edited\" boolean DEFAULT false NOT NULL,\"selected_model\" varchar(50) NOT NULL,\"reasoning_level\" varchar(50) DEFAULT 'none' NOT NULL,\"web_search_enabled\" boolean DEFAULT false NOT NULL,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "CREATE TABLE \"message_segments\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"message_id\" uuid NOT NULL,\"ordinal\" integer NOT NULL,\"kind\" varchar(50) NOT NULL,\"content\" text,\"tool_name\" text,\"tool_args\" jsonb,\"tool_result\" jsonb,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "CREATE TABLE \"messages\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"chat_id\" uuid NOT NULL,\"thread_id\" uuid NOT NULL,\"parent_message_id\" uuid,\"version\" integer DEFAULT 1 NOT NULL,\"role\" varchar(50) NOT NULL,\"status\" varchar(50) DEFAULT 'processing' NOT NULL,\"metadata\" jsonb,\"model\" varchar(50) NOT NULL,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "CREATE TABLE \"message_tokens\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"message_id\" uuid NOT NULL,\"kind\" varchar(50) NOT NULL,\"tokens\" text NOT NULL,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "CREATE TABLE \"threads\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"chat_id\" uuid NOT NULL,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "CREATE TABLE \"user\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"name\" text NOT NULL,\"email\" text NOT NULL,\"profile_picture\" text,\"role\" varchar(255) DEFAULT 'USER' NOT NULL,\"subscribed_until\" timestamp with time zone,CONSTRAINT \"user_email_unique\" UNIQUE(\"email\"));",
      "CREATE INDEX \"message_segments_message_id_ordinal_index\" ON \"message_segments\" USING btree (\"message_id\",\"ordinal\");",
      "CREATE INDEX \"messages_thread_id_created_at_index\" ON \"messages\" USING btree (\"thread_id\",\"created_at\");",
      "CREATE UNIQUE INDEX \"messages_parent_message_id_version_index\" ON \"messages\" USING btree (\"parent_message_id\",\"version\");",
      "CREATE INDEX \"threads_chat_id_created_at_index\" ON \"threads\" USING btree (\"chat_id\",\"created_at\");"
    ]
  },
  {
    "idx": 1,
    "when": 1749922452109,
    "tag": "0001_simple_night_thrasher",
    "hash": "810a7e359d0f02c03e2eed9fb3a77e30b3b517edc3ae5b5dca230811c02a2c81",
    "sql": [
      "ALTER TABLE \"messages\" ADD COLUMN \"reasoning_level\" varchar(50) DEFAULT 'none' NOT NULL;",
      "ALTER TABLE \"messages\" ADD COLUMN \"web_search_enabled\" boolean DEFAULT false NOT NULL;"
    ]
  },
  {
    "idx": 2,
    "when": 1749999276314,
    "tag": "0002_charming_union_jack",
    "hash": "00c91d9c42f42258ced12af5a83468aab56e3e5086b192d7ad395197aff18b73",
    "sql": ["ALTER TABLE \"messages\" ADD COLUMN \"error\" text;"]
  },
  {
    "idx": 3,
    "when": 1750451386203,
    "tag": "0003_perpetual_scalphunter",
    "hash": "d579813f532ffb1016f53c7427bb77b11addb4f7c2030c533637ec8ef8f6fb6e",
    "sql": [
      "CREATE INDEX \"title_search_index\" ON \"chats\" USING gin (to_tsvector('english', \"title\"));",
      "CREATE INDEX \"content_search_index\" ON \"message_segments\" USING gin (to_tsvector('english', \"content\"));"
    ]
  },
  {
    "idx": 4,
    "when": 1750797808889,
    "tag": "0004_eager_crystal",
    "hash": "fd63341ca3735941ad665f912354b1983189971090859f20e79a4a4920d4cffb",
    "sql": [
      "CREATE TABLE \"message_segment_usage\" (    \"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid () NOT NULL,    \"user_id\" uuid NOT NULL,    \"generation_id\" uuid NOT NULL,    \"is_byok\" boolean DEFAULT false NOT NULL,    \"model\" text,    \"origin\" text,    \"provider_name\" text,    \"usage\" double precision,    \"cache_discount\" double precision,    \"tokens_prompt\" integer,    \"tokens_completion\" integer,    \"num_media_prompt\" integer,    \"num_media_completion\" integer,    \"num_search_results\" integer,    CONSTRAINT \"message_segment_usage_generationId_unique\" UNIQUE (\"generation_id\"));",
      "ALTER TABLE \"message_segments\" ADD COLUMN \"generation_id\" uuid;",
      "ALTER TABLE \"message_tokens\" ADD COLUMN \"generation_id\" uuid;",
      "ALTER TABLE \"messages\" DROP COLUMN \"metadata\" CASCADE;"
    ]
  },
  {
    "idx": 5,
    "when": 1750798013998,
    "tag": "0005_neat_zodiak",
    "hash": "e712cd45634900b2db28bb31c47e238268c8f21c58a98b30e9049d7c5ab74370",
    "sql": [
      "ALTER TABLE \"message_segment_usage\" ALTER COLUMN \"generation_id\" SET DATA TYPE varchar(50);",
      "ALTER TABLE \"message_segments\" ALTER COLUMN \"generation_id\" SET DATA TYPE varchar(50);",
      "ALTER TABLE \"message_tokens\" ALTER COLUMN \"generation_id\" SET DATA TYPE varchar(50);"
    ]
  },
  {
    "idx": 6,
    "when": 1751729562420,
    "tag": "0006_dry_maelstrom",
    "hash": "4d3d4162e4f1ab4a41fc67833eeb95dcae93117e2f9f798aed2328d3807673a1",
    "sql": ["ALTER TABLE \"user\" ADD COLUMN \"subscription_status\" varchar(255);"]
  },
  {
    "idx": 7,
    "when": 1751757359361,
    "tag": "0007_cold_azazel",
    "hash": "49995c3bf3dedf92e1c6822c0dc4844e873b08a6a6f0c1c8aa8f22af0cc0ef25",
    "sql": ["ALTER TABLE \"chats\" ADD COLUMN \"pinned\" boolean DEFAULT false NOT NULL;"]
  },
  {
    "idx": 8,
    "when": 1751909175077,
    "tag": "0008_broken_proudstar",
    "hash": "79d44a61d56fc676d1d2dd716c26f529b7c839b9879f1d8a494b613d3c2f5a43",
    "sql": ["ALTER TABLE \"user\" ADD COLUMN \"subscription_plan\" varchar(50);"]
  },
  {
    "idx": 9,
    "when": 1752094419545,
    "tag": "0009_brief_mongoose",
    "hash": "9f7fd66109fa11258f339845bba0c895f8df8afe229686397c76e78d131d4f92",
    "sql": [
      "ALTER TABLE \"message_segment_usage\" ADD COLUMN \"estimated_c_us\" integer;",
      "ALTER TABLE \"message_segment_usage\" ADD COLUMN \"actual_c_us\" integer;",
      "ALTER TABLE \"message_segment_usage\" ADD COLUMN \"private\" boolean DEFAULT false NOT NULL;"
    ]
  },
  {
    "idx": 10,
    "when": 1752332765696,
    "tag": "0010_curved_susan_delgado",
    "hash": "dc8963ea1bf7572969b6fcbb512fd1d4dfe26e1398af4bb3aa52d5c4994e4fb7",
    "sql": [
      "CREATE TABLE \"drafts\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"content\" text NOT NULL,\"selected_model\" varchar(50) NOT NULL,\"reasoning_level\" varchar(50) DEFAULT 'none' NOT NULL,\"web_search_enabled\" boolean DEFAULT false NOT NULL,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "DROP INDEX \"messages_parent_message_id_version_index\";",
      "CREATE INDEX \"drafts_user_id_updated_at_index\" ON \"drafts\" USING btree (\"user_id\",\"updated_at\");"
    ]
  },
  {
    "idx": 11,
    "when": 1752354555793,
    "tag": "0011_free_spot",
    "hash": "37dd354787d1c5b680125ee6441d1346de1573a07e1672e6b4127910c3f0dd37",
    "sql": [
      "DROP TABLE \"message_tokens\" CASCADE;",
      "ALTER TABLE \"message_segments\"ADD COLUMN \"streaming\" boolean DEFAULT false NOT NULL;"
    ]
  },
  {
    "idx": 12,
    "when": 1753132741630,
    "tag": "0012_tricky_young_avengers",
    "hash": "9941de581bde387a48e4158af90e79dd71326d76e64ba0e7502266ff6e865f7c",
    "sql": ["ALTER TABLE \"user\" ADD COLUMN \"email_verified\" boolean DEFAULT false NOT NULL;"]
  },
  {
    "idx": 13,
    "when": 1753209993519,
    "tag": "0013_burly_mesmero",
    "hash": "6f4926d3f2e25b8b35171bf9a2c0bdf52be7f30c3e3c72763431b5d84b3d93bc",
    "sql": [
      "ALTER TABLE \"chats\" ADD COLUMN \"archived\" boolean DEFAULT false NOT NULL;",
      "ALTER TABLE \"chats\" ADD COLUMN \"deleted_at\" timestamp with time zone;"
    ]
  },
  {
    "idx": 14,
    "when": 1753559633360,
    "tag": "0014_peaceful_molecule_man",
    "hash": "fd6f76134410b2d66b31b2043e90afa56c52cf61d724e5e439bccf279e40826c",
    "sql": [
      "CREATE TABLE \"byok\" (\"id\" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\"user_id\" uuid NOT NULL,\"api_key\" text NOT NULL,\"platform\" varchar(255) NOT NULL,\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL);",
      "ALTER TABLE \"user\" ALTER COLUMN \"role\" SET DEFAULT 'ANONYMOUS';",
      "ALTER TABLE \"chats\" ADD COLUMN \"byok_id\" uuid;",
      "ALTER TABLE \"byok\" ADD CONSTRAINT \"byok_user_id_user_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE no action ON UPDATE no action;"
    ]
  }
]
